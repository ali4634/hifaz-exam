 <!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>امتحانی رزلٹ PWA</title>

    <!-- PWA کے لیے ضروری ٹیگز -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff"/>
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf-autotable.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Nastaliq Urdu', sans-serif;
            background-color: #f8f9fa;
            color: #343a40;
            margin: 0;
            padding: 8px; /* مزید کم جگہ */
        }
        .container {
            max-width: 800px; /* کنٹینر کو چھوٹا کیا گیا */
            margin: auto;
            background-color: #ffffff;
            padding: 15px; /* اندرونی جگہ کم کی گئی */
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1 { font-size: 22px; }
        h2 { font-size: 18px; }
        h1, h2 {
            text-align: center;
            color: #0056b3;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 8px;
            margin-top: 5px;
            margin-bottom: 15px;
        }
        #add-student-form {
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* کم از کم چوڑائی کم کی گئی */
            gap: 8px; /* فیلڈز کے درمیان فاصلہ کم کیا گیا */
        }
        .form-group label { font-size: 14px; margin-bottom: 4px; }
        .form-group input, .form-group textarea {
            padding: 7px; /* فیلڈ کا سائز کم کیا گیا */
            border-radius: 4px;
            border: 1px solid #ced4da;
            font-family: inherit;
            font-size: 14px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px; /* ٹیبل کا فونٹ سائز کم کیا گیا */
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 6px; /* ٹیبل خانوں کا سائز کم کیا گیا */
            text-align: right;
            vertical-align: middle;
        }
        th { background-color: #007bff; color: white; }
        td:nth-child(6) { max-width: 180px; word-wrap: break-word; } /* تبصرہ کالم */
        .btn {
            padding: 8px 12px; /* بٹن کا سائز کم کیا گیا */
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            color: white;
            font-family: inherit;
        }
        .btn-danger-small { padding: 4px 8px; font-size: 12px; }
        .btn-primary { background-color: #007bff; }
        .btn-success { background-color: #28a745; }
        .btn-danger { background-color: #dc3545; }
        .btn-info { background-color: #17a2b8; }
        .button-group {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 8px; /* بٹنوں میں فاصلہ کم کیا گیا */
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>امتحانی رزلٹ PWA</h1>
        <div id="add-student-form">
            <h2>نیا طالب علم شامل کریں</h2>
            <div class="form-grid">
                <div class="form-group"><label for="studentName">نام:</label><input type="text" id="studentName"></div>
                <div class="form-group"><label for="q1Marks">سوال 1(33):</label><input type="number" id="q1Marks" max="33"></div>
                <div class="form-group"><label for="q2Marks">سوال 2(33):</label><input type="number" id="q2Marks" max="33"></div>
                <div class="form-group"><label for="q3Marks">سوال 3(34):</label><input type="number" id="q3Marks" max="34"></div>
            </div>
            <div class="form-group" style="margin-top: 8px;"><label for="comments">تبصرہ:</label><textarea id="comments" rows="2"></textarea></div>
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn btn-primary" onclick="addStudent()">لسٹ میں شامل کریں</button>
            </div>
        </div>
        <hr style="margin: 20px 0;">
        <h2>تمام طلباء کا رزلٹ</h2>
        <table id="studentsTable">
            <thead><tr><th>نام</th><th>سوال1</th><th>سوال2</th><th>سوال3</th><th>کل</th><th>تبصرہ</th><th>عمل</th></tr></thead>
            <tbody></tbody>
        </table>
        <div class="button-group">
            <button class="btn btn-success" onclick="saveData()">محفوظ کریں</button>
            <button class="btn btn-danger" onclick="resetAllData()">ری سیٹ</button>
        </div>
        <div class="button-group">
             <button class="btn btn-info" onclick="generatePdf()">PDF ڈاؤنلوڈ</button>
             <button class="btn btn-success" onclick="shareOnWhatsApp()">واٹس ایپ</button>
        </div>
    </div>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('sw.js').then(reg => console.log('SW registered.')).catch(err => console.log('SW registration failed: ', err)); });
    }
    document.addEventListener('DOMContentLoaded', loadStudents);
    function addStudent() {
        const name = document.getElementById('studentName').value.trim();
        const q1 = parseInt(document.getElementById('q1Marks').value) || 0;
        const q2 = parseInt(document.getElementById('q2Marks').value) || 0;
        const q3 = parseInt(document.getElementById('q3Marks').value) || 0;
        const comments = document.getElementById('comments').value.trim();
        if (!name) { alert('براہ کرم طالب علم کا نام درج کریں۔'); return; }
        displayStudentInTable({ name, q1, q2, q3, total: q1 + q2 + q3, comments });
        document.getElementById('add-student-form').reset();
    }
    function displayStudentInTable(student) {
        const row = document.querySelector("#studentsTable tbody").insertRow();
        row.innerHTML = `<td>${student.name}</td><td>${student.q1}</td><td>${student.q2}</td><td>${student.q3}</td><td><b>${student.total}</b></td><td>${student.comments}</td><td><button class="btn btn-danger btn-danger-small" onclick="deleteRow(this)">حذف</button></td>`;
    }
    function deleteRow(btn) { if (confirm('کیا آپ واقعی اس طالب علم کو حذف کرنا چاہتے ہیں؟')) { btn.closest('tr').remove(); } }
    function saveData() {
        const data = Array.from(document.querySelectorAll("#studentsTable tbody tr")).map(row => ({ name: row.cells[0].innerText, q1: row.cells[1].innerText, q2: row.cells[2].innerText, q3: row.cells[3].innerText, total: row.cells[4].innerText, comments: row.cells[5].innerText }));
        localStorage.setItem('examStudentsData', JSON.stringify(data));
        alert('ڈیٹا کامیابی سے محفوظ ہو گیا ہے!');
    }
    function loadStudents() {
        const data = localStorage.getItem('examStudentsData');
        if (data) { JSON.parse(data).forEach(s => displayStudentInTable(s)); }
    }
    function resetAllData() {
        if (confirm('کیا آپ واقعی تمام ڈیٹا مستقل طور پر حذف کرنا چاہتے ہیں؟')) {
            localStorage.removeItem('examStudentsData');
            document.querySelector("#studentsTable tbody").innerHTML = '';
            alert('تمام ڈیٹا حذف کر دیا گیا ہے۔');
        }
    }
    function shareOnWhatsApp() {
        const rows = document.querySelectorAll("#studentsTable tbody tr");
        if (rows.length === 0) { alert("شیئر کرنے کے لیے کوئی ڈیٹا نہیں ہے۔"); return; }
        let msg = "السلام علیکم\n*امتحانی رزلٹ کا خلاصہ*\n\n" + Array.from(rows).map((row, i) => `${i + 1}. *${row.cells[0].innerText}*: ${row.cells[4].innerText} نمبر`).join('\n');
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }
    function generatePdf() {
        alert('پی ڈی ایف تیار کیا جا رہا ہے۔۔۔');
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(20).text("تمام طلباء کا رزلٹ", doc.internal.pageSize.width / 2, 15, { align: 'center' });
        doc.setFontSize(10).text(new Date().toLocaleDateString(), doc.internal.pageSize.width / 2, 22, { align: 'center' });
        doc.autoTable({ html: '#studentsTable', startY: 30, theme: 'grid', headStyles: { fillColor: [0, 123, 255], halign: 'center' }, styles: { font: 'sans-serif', halign: 'right' }, columnStyles: { 0: { halign: 'right' } }, didParseCell: (data) => { if (data.column.index === 6) data.cell.text = ''; } });
        doc.save('طلباء-کا-رزلٹ.pdf');
    }
</script>
</body>
</html>
